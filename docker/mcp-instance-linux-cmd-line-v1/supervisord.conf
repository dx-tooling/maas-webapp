[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:xvfb]
command=/usr/bin/Xvfb %(ENV_DISPLAY)s -screen 0 %(ENV_SCREEN_WIDTH)sx%(ENV_SCREEN_HEIGHT)sx%(ENV_COLOR_DEPTH)s
user=mcp
autostart=true
autorestart=true
priority=10
stdout_logfile=/home/mcp/logs/xvfb.log
stderr_logfile=/home/mcp/logs/xvfb.log

[program:mcp-linux-cmd-line]
command=/usr/local/bin/node /home/mcp/node_modules/maas-mcpserver-linux-cmd-line/dist/server.js --http
directory=/home/mcp
user=mcp
# Ensure correct environment so node resolves binaries and home correctly, and port is set
environment=HOME="/home/mcp",USER="mcp",PORT="%(ENV_MCP_PORT)s"
autostart=true
autorestart=true
priority=20
stdout_logfile=/home/mcp/logs/mcp-linux-cmd-line.log
stderr_logfile=/home/mcp/logs/mcp-linux-cmd-line.log
depends_on=xvfb

[program:xterm]
command=/bin/bash -lc 'mkdir -p /home/mcp/logs && touch /home/mcp/logs/exec.log && xterm -fa Monospace -fs 11 -bg black -fg grey -maximized -e tail -F /home/mcp/logs/exec.log'
directory=/home/mcp
user=mcp
environment=DISPLAY="%(ENV_DISPLAY)s",HOME="/home/mcp",USER="mcp"
autostart=true
autorestart=true
priority=25
stdout_logfile=/home/mcp/logs/xterm.log
stderr_logfile=/home/mcp/logs/xterm.log
depends_on=xvfb

[program:x11vnc]
command=/bin/bash -c 'echo "%(ENV_VNC_PASSWORD)s" | vncpasswd -f > /home/mcp/vnc/passwd && x11vnc -display %(ENV_DISPLAY)s -forever -shared -rfbport %(ENV_VNC_PORT)s -rfbauth /home/mcp/vnc/passwd'
user=mcp
autostart=true
autorestart=true
priority=30
stdout_logfile=/home/mcp/logs/x11vnc.log
stderr_logfile=/home/mcp/logs/x11vnc.log
depends_on=xvfb

[program:websockify]
command=/usr/bin/websockify --web=/usr/share/novnc/ %(ENV_NOVNC_PORT)s localhost:%(ENV_VNC_PORT)s
user=mcp
autostart=true
autorestart=true
priority=40
stdout_logfile=/home/mcp/logs/websockify.log
stderr_logfile=/home/mcp/logs/websockify.log
depends_on=x11vnc

