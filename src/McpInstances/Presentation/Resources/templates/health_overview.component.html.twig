{# @var this \App\McpInstances\Presentation\Components\HealthOverviewComponent #}
<div {{ attributes }} data-poll="delay(2000)|$render">
    {% set g = this.getGenericStatus() %}
    {% set all = g ? (g.endpoints is not empty and g.endpoints|filter(e => e.up)|length == g.endpoints|length) : false %}
    <div class="etfswui-card mb-8 text-left">
        <div class="etfswui-card-title flex items-center justify-between">
            <span class="etfswui-card-title-text">Instance Health Status</span>
            <div class="flex items-center gap-3">
                {% if g and all %}
                    <span class="etfswui-badge etfswui-badge-success">All Systems Operational</span>
                {% elseif g %}
                    <span class="etfswui-badge etfswui-badge-warning">Some Issues Detected</span>
                {% else %}
                    <span class="etfswui-badge etfswui-badge-info">Loading...</span>
                {% endif %}
            </div>
        </div>
        <div class="etfswui-card-content">
            {% if g %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {# Container tile #}
                    <div class="flex items-center justify-between p-4 rounded-md border {{ g.containerRunning ? 'bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800' : 'bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800' }}">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full {{ g.containerRunning ? 'bg-green-500' : 'bg-red-500' }}"></div>
                            <div>
                                <div class="font-semibold text-sm">Container</div>
                                <div class="text-xs text-dark-500 dark:text-dark-400">{{ g.containerName }} ({{ g.containerState }})</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="etfswui-badge {{ g.containerRunning ? 'etfswui-badge-success' : 'etfswui-badge-error' }} text-xs">{{ g.containerRunning ? 'Running' : 'Stopped' }}</span>
                        </div>
                    </div>

                    {# Dynamic endpoints #}
                    {% for ep in g.endpoints %}
                        <div class="flex items-center justify-between p-4 rounded-md border {{ ep.up ? 'bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800' : 'bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800' }}">
                            <div class="flex items-center gap-3">
                                <div class="w-3 h-3 rounded-full {{ ep.up ? 'bg-green-500' : 'bg-red-500' }}"></div>
                                <div>
                                    <div class="font-semibold text-sm">{{ ep.id|upper }}</div>
                                    {% if ep.externalUrls|length > 0 %}
                                        <div class="text-xs text-dark-500 dark:text-dark-400 truncate">{{ ep.externalUrls[0]|replace({'https://': ''}) }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="etfswui-badge {{ ep.up ? 'etfswui-badge-success' : 'etfswui-badge-error' }} text-xs">{{ ep.up ? 'Running' : 'Stopped' }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="etfswui-text-small text-dark-500 dark:text-dark-400">No status available.</div>
            {% endif %}
        </div>
    </div>
</div>


