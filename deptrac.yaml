# deptrac.yaml - Cross-Vertical Isolation Rules
deptrac:
  paths:
    - ./src
  exclude_files:
    - '#.*test.*#'
    - '#.*Test.*#'
    - '#.*tests.*#'
    - '#src/Kernel\.php#'

  layers:
    # Business Vertical
    - name: Business_Facade
      collectors:
        - type: directory
          value: src/Business/Facade/.*
    - name: Business_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/Business/.*
          must_not:
            - type: directory
              value: src/Business/Facade/.*

    # CustomerSupportPackage Vertical
    - name: CustomerSupportPackage_Facade
      collectors:
        - type: directory
          value: src/CustomerSupportPackage/Facade/.*
    - name: CustomerSupportPackage_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/CustomerSupportPackage/.*
          must_not:
            - type: directory
              value: src/CustomerSupportPackage/Facade/.*

    # LiveDemo Vertical
    - name: LiveDemo_Facade
      collectors:
        - type: directory
          value: src/LiveDemo/Facade/.*
    - name: LiveDemo_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/LiveDemo/.*
          must_not:
            - type: directory
              value: src/LiveDemo/Facade/.*

    # MessageRetrieval Vertical
    - name: MessageRetrieval_Facade
      collectors:
        - type: directory
          value: src/MessageRetrieval/Facade/.*
    - name: MessageRetrieval_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/MessageRetrieval/.*
          must_not:
            - type: directory
              value: src/MessageRetrieval/Facade/.*

    # ResponseGenerator Vertical
    - name: ResponseGenerator_Facade
      collectors:
        - type: directory
          value: src/ResponseGenerator/Facade/.*
    - name: ResponseGenerator_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/ResponseGenerator/.*
          must_not:
            - type: directory
              value: src/ResponseGenerator/Facade/.*

    # ContentRetrieval Vertical
    - name: ContentRetrieval_Facade
      collectors:
        - type: directory
          value: src/ContentRetrieval/Facade/.*
    - name: ContentRetrieval_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/ContentRetrieval/.*
          must_not:
            - type: directory
              value: src/ContentRetrieval/Facade/.*

    # WebsiteContent Vertical
    - name: WebsiteContent_Facade
      collectors:
        - type: directory
          value: src/WebsiteContent/Facade/.*
    - name: WebsiteContent_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/WebsiteContent/.*
          must_not:
            - type: directory
              value: src/WebsiteContent/Facade/.*

    # Common (shared utilities)
    - name: Common_Facade
      collectors:
        - type: directory
          value: src/Common/Facade/.*
    - name: Common_Internal
      collectors:
        - type: bool
          must:
            - type: directory
              value: src/Common/.*
          must_not:
            - type: directory
              value: src/Common/Facade/.*

  ruleset:
    # Cross-Vertical Access Rules: Only Facades are accessible from other verticals

    # Business rules
    Business_Facade:
      - Business_Internal
      - Common_Facade
    Business_Internal:
      - Business_Facade
      - Common_Facade

    # CustomerSupportPackage rules
    CustomerSupportPackage_Facade:
      - CustomerSupportPackage_Internal
      - Business_Facade
      - Common_Facade
    CustomerSupportPackage_Internal:
      - CustomerSupportPackage_Facade
      - Business_Facade
      - Common_Facade

    # LiveDemo rules
    LiveDemo_Facade:
      - LiveDemo_Internal
      - Business_Facade
      - CustomerSupportPackage_Facade
      - MessageRetrieval_Facade
      - ResponseGenerator_Facade
      - Common_Facade
    LiveDemo_Internal:
      - LiveDemo_Facade
      - Business_Facade
      - CustomerSupportPackage_Facade
      - MessageRetrieval_Facade
      - ResponseGenerator_Facade
      - ContentRetrieval_Facade
      - Common_Facade

    # MessageRetrieval rules
    MessageRetrieval_Facade:
      - MessageRetrieval_Internal
      - Common_Facade
    MessageRetrieval_Internal:
      - MessageRetrieval_Facade
      - Common_Facade

    # ResponseGenerator rules
    ResponseGenerator_Facade:
      - ResponseGenerator_Internal
      - Business_Facade
      - CustomerSupportPackage_Facade
      - ContentRetrieval_Facade
      - Common_Facade
    ResponseGenerator_Internal:
      - ResponseGenerator_Facade
      - Business_Facade
      - CustomerSupportPackage_Facade
      - ContentRetrieval_Facade
      - Common_Facade

    # ContentRetrieval rules
    ContentRetrieval_Facade:
      - ContentRetrieval_Internal
      - Common_Facade
    ContentRetrieval_Internal:
      - ContentRetrieval_Facade
      - Common_Facade

    # WebsiteContent rules
    WebsiteContent_Facade:
      - WebsiteContent_Internal
      - Common_Facade
    WebsiteContent_Internal:
      - WebsiteContent_Facade
      - Common_Facade

    # Common rules (can access itself freely)
    Common_Facade:
      - Common_Internal
    Common_Internal:
      - Common_Facade
