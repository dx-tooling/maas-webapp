[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:xvfb]
command=/usr/bin/Xvfb %(ENV_DISPLAY)s -screen 0 %(ENV_SCREEN_WIDTH)sx%(ENV_SCREEN_HEIGHT)sx%(ENV_COLOR_DEPTH)s
user=mcp
autostart=true
autorestart=true
priority=10
stdout_logfile=/home/mcp/logs/xvfb.log
stderr_logfile=/home/mcp/logs/xvfb.log

[program:playwright-mcp]
command=/usr/local/bin/node /home/mcp/node_modules/.bin/mcp-server-playwright --port %(ENV_MCP_PORT)s --no-sandbox --isolated --browser chromium --host 0.0.0.0
directory=/home/mcp
user=mcp
# user= alone does not create a sufficiently precise environment for playwright-mcp, making it look for browser installations in /root
environment=DISPLAY="%(ENV_DISPLAY)s",HOME="/home/mcp",USER="mcp"
autostart=true
autorestart=true
priority=20
stdout_logfile=/home/mcp/logs/playwright-mcp.log
stderr_logfile=/home/mcp/logs/playwright-mcp.log
depends_on=xvfb

[program:x11vnc]
command=/bin/bash -c 'echo "%(ENV_VNC_PASSWORD)s" | vncpasswd -f > /home/mcp/vnc/passwd && x11vnc -display %(ENV_DISPLAY)s -forever -shared -rfbport %(ENV_VNC_PORT)s -rfbauth /home/mcp/vnc/passwd'
user=mcp
autostart=true
autorestart=true
priority=30
stdout_logfile=/home/mcp/logs/x11vnc.log
stderr_logfile=/home/mcp/logs/x11vnc.log
depends_on=xvfb

[program:websockify]
command=/usr/bin/websockify --web=/usr/share/novnc/ %(ENV_NOVNC_PORT)s localhost:%(ENV_VNC_PORT)s
user=mcp
autostart=true
autorestart=true
priority=40
stdout_logfile=/home/mcp/logs/websockify.log
stderr_logfile=/home/mcp/logs/websockify.log
depends_on=x11vnc
